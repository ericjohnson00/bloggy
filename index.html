<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog</title>
    <link rel="stylesheet" href="/static/style.css" />
    <style>
      /* Add these styles directly in the head to override or add to your style.css */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
      }

      .modal-content {
        background-color: white;
        margin: 40px auto;
        padding: 2rem;
        width: 90%;
        max-width: 800px;
        border-radius: 8px;
        position: relative;
        box-sizing: border-box;
      }

      .post-content {
        line-height: 1.6;
        margin: 1rem 0;
        overflow-wrap: break-word;
        word-wrap: break-word;
      }

      .post-images img {
        max-width: 100%;
        height: auto;
        margin: 10px 0;
        border-radius: 4px;
      }

      .close {
        position: absolute;
        right: 1rem;
        top: 1rem;
        font-size: 2rem;
        cursor: pointer;
        line-height: 1;
        padding: 5px;
        z-index: 1000;
      }

      .close:hover {
        color: #666;
      }

      /* Ensure the modal content has proper padding at the bottom */
      #modal-post-content {
        padding-bottom: 2rem;
      }

      /* Add some spacing after the last image */
      .post-images {
        margin-bottom: 2rem;
      }

      /* Ensure proper spacing for the post meta information */
      .post-meta {
        margin: 1rem 0;
        color: #666;
      }

      .post-meta .author {
        margin-right: 1rem;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>My Blog</h1>
      <a href="/admin" class="admin-link">Admin Panel</a>
    </header>

    <main>
      <div id="posts-container" class="posts-grid"></div>
    </main>

    <div id="post-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-post-content"></div>
      </div>
    </div>

    <script>
      async function loadPosts() {
        const response = await fetch("/api/posts");
        const posts = await response.json();

        const container = document.getElementById("posts-container");
        container.innerHTML = posts
          .map(
            (post) => `
                <div class="post-card" onclick="openPost(${post.id})">
                    ${
                      post.images && post.images.length > 0
                        ? `<img src="/static/uploads/${post.images[0]}" alt="Post image" class="post-thumbnail">`
                        : ""
                    }
                    <h2>${post.title}</h2>
                    <p>${post.content.substring(0, 150)}...</p>
                    <div class="post-meta">
                        <span class="author">By ${post.author}</span>
                        <span class="date">${new Date(
                          post.created_date
                        ).toLocaleDateString()}</span>
                    </div>
                </div>
            `
          )
          .join("");
      }

      async function openPost(id) {
        const response = await fetch(`/api/post/${id}`);
        const post = await response.json();

        const modal = document.getElementById("post-modal");
        const content = document.getElementById("modal-post-content");

        content.innerHTML = `
                <h2>${post.title}</h2>
                <div class="post-meta">
                    <span class="author">By ${post.author}</span>
                    <span class="date">${new Date(
                      post.created_date
                    ).toLocaleDateString()}</span>
                </div>
                <div class="post-images">
                    ${post.images
                      .map(
                        (img) => `
                        <img src="/static/uploads/${img}" alt="Post image">
                    `
                      )
                      .join("")}
                </div>
                <div class="post-content">${post.content}</div>
            `;

        modal.style.display = "block";

        // Prevent body scrolling when modal is open
        document.body.style.overflow = "hidden";
      }

      // Updated close function to restore body scrolling
      document.querySelector(".close").onclick = function () {
        document.getElementById("post-modal").style.display = "none";
        document.body.style.overflow = "auto";
      };

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("post-modal");
        if (event.target == modal) {
          modal.style.display = "none";
          document.body.style.overflow = "auto";
        }
      };

      document.addEventListener("DOMContentLoaded", loadPosts);
    </script>
  </body>
</html>
